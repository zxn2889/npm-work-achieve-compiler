"use strict";var e,n;!function(e){e[e.Root=0]="Root",e[e.Element=1]="Element",e[e.Text=2]="Text",e[e.FunctionDecl=3]="FunctionDecl",e[e.Identifier=4]="Identifier",e[e.ReturnStatement=5]="ReturnStatement",e[e.CallExpression=6]="CallExpression",e[e.TagNode=7]="TagNode",e[e.ArrayParamsNode=8]="ArrayParamsNode"}(e||(e={})),function(e){e[e.origin=1]="origin",e[e.startTag=2]="startTag",e[e.tagName=3]="tagName",e[e.text=4]="text",e[e.endTag=5]="endTag",e[e.endTagName=6]="endTagName"}(n||(n={}));var t,r,a={origin:n.origin,startTag:n.startTag,tagName:n.tagName,text:n.text,endTag:n.endTag,endTagName:n.endTagName};function o(n){for(var r=function(e){var n=[],r=[],o=a.origin;function i(e){var n=e.charCodeAt(0);return n>=65&&n<=90||n>=97&&n<=122||/^[\u4E00-\u9FA5]+$/.test(e)||/\s/.test(e)||/\w/.test(e)||"."===e}for(var c=0;c<e.length;c++){var d=e[c];if("<"!==d){if(i(d)){if(r.push(d),o===a.startTag){o=a.tagName;continue}if(o===a.origin){o=a.text;continue}if(o===a.endTag){o=a.endTagName;continue}}else if(">"===d){if(o===a.tagName){n.push({type:t.StartTag,tag:r.join("")}),r.length=0,o=a.origin;continue}if(o===a.endTagName){n.push({type:t.EndTag,tag:r.join("")}),r.length=0,o=a.origin;continue}}else if("/"===d){o=a.endTag;continue}}else o===a.text&&(n.push({type:t.Text,content:r.join("")}),r.length=0),o=a.startTag}return n}(n),o={type:e.Root,children:[]},i=[],c=[],d=0;d<r.length;d++){var u=r[d],l=u.type;if(l===t.StartTag&&"tag"in u){var s={type:e.Element,tag:u.tag,children:[]};(p=c[c.length-1])&&"children"in p?p.children.push(s):i.push(s),c.push(s)}else if(l===t.EndTag)c.pop();else if(l===t.Text&&"content"in u){var p,f={type:e.Text,content:u.content};(p=c[c.length-1])&&"children"in p?p.children.push(f):i.push(f)}}return o.children=i,o}function i(e,n,t){if(t||2===arguments.length)for(var r,a=0,o=n.length;a<o;a++)!r&&a in n||(r||(r=Array.prototype.slice.call(n,0,a)),r[a]=n[a]);return e.concat(r||Array.prototype.slice.call(n))}function c(n){return function(){var t;n.type===e.Text&&(n.jsNode=(t=n.content,{type:e.Text,context:t}))}}function d(n){return function(){if(n.type===e.Element){var t,a,o=function(n){return{type:e.TagNode,name:n}}(n.tag),i=(t=[o],{type:e.CallExpression,id:(a=r.H,{type:e.Identifier,name:a}),nodes:t});1===n.children.length?i.nodes.push(n.children[0].jsNode):i.nodes.push(function(n){return{type:e.ArrayParamsNode,params:n}}(n.children.map((function(e){return e.jsNode})))),n.jsNode=i}}}function u(n){return function(){if(n.type===e.Root){var t=n.children[0].jsNode;n.jsNode={type:e.FunctionDecl,id:{type:e.Identifier,name:r.Render},params:[],body:[{type:e.ReturnStatement,return:t}]}}}}!function(e){e[e.StartTag=0]="StartTag",e[e.EndTag=1]="EndTag",e[e.Text=2]="Text"}(t||(t={})),"function"==typeof SuppressedError&&SuppressedError,function(e){e.Render="render",e.H="h"}(r||(r={}));var l=null;function s(e,n){void 0===n&&(n=[]);var t={currentNode:null,childIndex:null,parentNode:null,funcs:i([c,d,u],n,!0),removeASTNode:function(){return g.call(t)},replaceASTNode:function(e){return f.call(t,e)}};h(t),p(e,t),h(null)}function p(n,t){t.currentNode=n;var r=n,a=t.funcs,o=[];if(a.length)for(var i=0;i<a.length;i++){var c=a[i](r,t);if(c&&o.push(c),!r)return}if(r.type!==e.Text){var d=r.children;if(d)for(i=0;i<d.length;i++)t.childIndex=i,t.parentNode=r,p(d[i],t)}if(o.length)for(i=o.length-1;i>=0;i--)o[i]()}function f(e){this.parentNode&&(this.currentNode=e,this.parentNode.children[this.childIndex]=e)}function g(){this.parentNode&&(this.parentNode.children.splice(this.childIndex,1),this.currentNode=null)}function h(e){l=e}function m(n){if(n.type===e.FunctionDecl){var t="";return n.type===e.FunctionDecl&&(t+="function"),n.id.type===e.Identifier&&(t+=" ".concat(n.id.name)),n.params.length?t+="(".concat(n.params.join(),")"):t+="()",n.body.length?1===n.body.length&&n.body[0].type===e.ReturnStatement&&(t+="{ return ".concat(y(n.body[0].return)," }")):t+="{ return null }",t}}function y(n){if(n.type===e.CallExpression){var t="";if(n.id.type===e.Identifier&&(t+=n.id.name),n.nodes.length)if(1===n.nodes.length)t+="(".concat(n.nodes[0].name,")");else{for(var r=0;r<n.nodes.length;r++){var a=n.nodes[r];if(a.type===e.TagNode)t+="('".concat(a.name,"'");else if(a.type===e.ArrayParamsNode){if(t+=", [",a.params.length)for(var o=0;o<a.params.length;o++){var i=a.params[o];i.type===e.CallExpression&&(t+="".concat(y(i)).concat(o!==a.params.length-1?", ":""))}t+="]"}else a.type===e.Text&&(t+=", ".concat(a.context))}t+=")"}return t}}exports.createGenerator=function(e){return function(e){if("jsNode"in e)return m(e.jsNode);console.warn("当前代码未经转换器转换")}(e)},exports.createOptimizeParser=function(e,n){void 0===n&&(n=[]),s(e,n)},exports.createParser=function(e){return o(e)},exports.dump=function n(t,r){void 0===r&&(r=0);var a=t.type,o=a===e.Root?"":a===e.Element?t.tag:t.content;if(console.log("".concat("-".repeat(r)).concat(a,":").concat(o)),t.children)for(var i=0;i<t.children.length;i++)n(t.children[i],r+2)},exports.getCurrentContext=function(){return l};
