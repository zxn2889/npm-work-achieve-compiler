"use strict";function e(e,t){return()=>{"Text"===e.type&&(e.jsNode={type:"Text",context:e.content})}}function t(e,t){return()=>{if("Element"!==e.type)return;const t=function(e){return{type:"TagNode",name:e}}(e.tag),n={type:"CallExpression",id:(o="h",{type:"Identifier",name:o}),nodes:[t]};var o;1===e.children.length?n.nodes.push(e.children[0].jsNode):n.nodes.push(function(e){return{type:"ArrayParamsNode",params:e}}(e.children.map((e=>e.jsNode)))),e.jsNode=n}}function n(e,t){return()=>{if("Root"!==e.type)return;const t=e.children[0].jsNode;e.jsNode={type:"FunctionDecl",id:{type:"Identifier",name:"render"},params:[],body:[{type:"ReturnStatement",return:t}]}}}let o=null;function r(r,l=[]){const s={currentNode:null,childIndex:null,parentNode:null,funcs:[e,t,n].concat(l),removeASTNode:()=>a.call(s),replaceASTNode:e=>c.call(s,e)};!function(e){o=e}(s),i(r,s)}function i(e,t){t.currentNode=e;const n=e,o=t.funcs,r=[];if(o.length)for(let e=0;e<o.length;e++){const i=o[e](n,t);if(i&&r.push(i),!n)return}const c=n.children;if(c)for(let e=0;e<c.length;e++)t.childIndex=e,t.parentNode=n,i(c[e],t);if(r.length)for(let e=r.length-1;e>=0;e--)r[e]()}function c(e){this.parentNode&&(this.currentNode=e,this.parentNode.children[this.childIndex]=e)}function a(){this.parentNode&&(this.parentNode.children.splice(this.childIndex,1),this.currentNode=null)}var l,s,u;function d(e){if(e.type===l.FunctionDecl){var t="";return e.type===l.FunctionDecl&&(t+="function"),e.id.type===l.Identifier&&(t+=" ".concat(e.id.name)),e.params.length?t+="(".concat(e.params.join(),")"):t+="()",e.body.length?1===e.body.length&&e.body[0].type===l.ReturnStatement&&(t+="{ return ".concat(p(e.body[0].return)," }")):t+="{ return null }",t}}function p(e){if(e.type===l.CallExpression){var t="";if(e.id.type===l.Identifier&&(t+=e.id.name),e.nodes.length)if(1===e.nodes.length)t+="(".concat(e.nodes[0].name,")");else{for(var n=0;n<e.nodes.length;n++){var o=e.nodes[n];if(o.type===l.TagNode)t+="('".concat(o.name,"'");else if(o.type===l.ArrayParamsNode){if(t+=", [",o.params.length)for(var r=0;r<o.params.length;r++){var i=o.params[r];i.type===l.CallExpression&&(t+="".concat(p(i)).concat(r!==o.params.length-1?", ":""))}t+="]"}else o.type===l.Text&&(t+=", ".concat(o.context))}t+=")"}return t}}!function(e){e[e.FunctionDecl=0]="FunctionDecl",e[e.Identifier=1]="Identifier",e[e.ReturnStatement=2]="ReturnStatement",e[e.CallExpression=3]="CallExpression",e[e.TagNode=4]="TagNode",e[e.ArrayParamsNode=5]="ArrayParamsNode",e[e.Text=6]="Text",e[e.Root=7]="Root"}(l||(l={})),function(e){e.Render="render",e.H="h"}(s||(s={})),function(e){e[e.Root=0]="Root",e[e.Element=1]="Element",e[e.Text=2]="Text"}(u||(u={})),exports.createGenerator=function(e){return function(e){if("jsNode"in e)return d(e.jsNode);console.warn("当前代码未经转换器转换")}(e)},exports.createOptimizeParser=function(e,t=[]){r(e,t)},exports.createParser=function(e){return function(e){const t=function(e){const t=1,n=2,o=3,r=4,i=5,c=6,a=[];let l=[],s=t;function u(e){const t=e.charCodeAt();return t>=65&&t<=90||t>=97&&t<=122||/^[\u4E00-\u9FA5]+$/.test(e)||/\s/.test(e)||/\w/.test(e)||"."===e}for(let d=0;d<e.length;d++){const p=e[d];if("<"!==p){if(u(p)){if(l.push(p),s===n){s=o;continue}if(s===t){s=r;continue}if(s===i){s=c;continue}}else if(">"===p){if(s===o){a.push({type:"startTag",tag:l.join("")}),l.length=0,s=t;continue}if(s===c){a.push({type:"endTag",tag:l.join("")}),l.length=0,s=t;continue}}else if("/"===p){s=i;continue}}else s===r&&(a.push({type:"text",content:l.join("")}),l.length=0),s=n}return a}(e),n={type:"Root",children:null},o=[],r=[];for(let e=0;e<t.length;e++){const n=t[e],i=n.type;if("startTag"===i){const e={type:"Element",tag:n.tag,children:[]},t=r[r.length-1];t?t.children.push(e):o.push(e),r.push(e)}else if("endTag"===i)r.pop();else if("text"===i){const e={type:"Text",content:n.content},t=r[r.length-1];t?t.children.push(e):o.push(eleNode)}}return n.children=o,n}(e)},exports.dump=function e(t,n){void 0===n&&(n=0);var o=t.type,r=o===u.Root?"":o===u.Element?t.tag:t.content;if(console.log("".concat("-".repeat(n)).concat(o,":").concat(r)),t.children)for(var i=0;i<t.children.length;i++)e(t.children[i],n+2)},exports.getCurrentContext=function(){return o};
