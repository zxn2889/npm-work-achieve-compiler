"use strict";function e(e,t){return()=>{"Text"===e.type&&(e.jsNode={type:"Text",context:e.content})}}function t(e,t){return()=>{if("Element"!==e.type)return;const t=function(e){return{type:"TagNode",name:e}}(e.tag),n={type:"CallExpression",id:(r="h",{type:"Identifier",name:r}),nodes:[t]};var r;1===e.children.length?n.nodes.push(e.children[0].jsNode):n.nodes.push(function(e){return{type:"ArrayParamsNode",params:e}}(e.children.map((e=>e.jsNode)))),e.jsNode=n}}function n(e,t){return()=>{if("Root"!==e.type)return;const t=e.children[0].jsNode;e.jsNode={type:"FunctionDecl",id:{type:"Identifier",name:"render"},params:[],body:[{type:"ReturnStatement",return:t}]}}}let r=null;function o(o,c=[]){const u={currentNode:null,childIndex:null,parentNode:null,funcs:[e,t,n].concat(c),removeASTNode:()=>s.call(u),replaceASTNode:e=>l.call(u,e)};!function(e){r=e}(u),i(o,u)}function i(e,t){t.currentNode=e;const n=e,r=t.funcs,o=[];if(r.length)for(let e=0;e<r.length;e++){const i=r[e](n,t);if(i&&o.push(i),!n)return}const l=n.children;if(l)for(let e=0;e<l.length;e++)t.childIndex=e,t.parentNode=n,i(l[e],t);if(o.length)for(let e=o.length-1;e>=0;e--)o[e]()}function l(e){this.parentNode&&(this.currentNode=e,this.parentNode.children[this.childIndex]=e)}function s(){this.parentNode&&(this.parentNode.children.splice(this.childIndex,1),this.currentNode=null)}function c(e){if("FunctionDecl"!==e.type)return;let t="";return"FunctionDecl"===e.type&&(t+="function"),"Identifier"===e.id.type&&(t+=` ${e.id.name}`),e.params.length?t+=`(${e.params.join()})`:t+="()",e.body.length?1===e.body.length&&"ReturnStatement"===e.body[0].type&&(t+=`{ return ${u(e.body[0].return)} }`):t+="{ return null }",t}function u(e){if("CallExpression"!==e.type)return;let t="";if("Identifier"===e.id.type&&(t+=e.id.name),e.nodes.length)if(1===e.nodes.length)t+=`(${e.nodes[0].name})`;else{for(let n=0;n<e.nodes.length;n++){const r=e.nodes[n];if("TagNode"===r.type)t+=`('${r.name}'`;else if("ArrayParamsNode"===r.type){if(t+=", [",r.params.length)for(let e=0;e<r.params.length;e++){const n=r.params[e];"CallExpression"===n.type&&(t+=`${u(n)}${e!==r.params.length-1?", ":""}`)}t+="]"}else"Text"===r.type&&(t+=`, ${r.context}`)}t+=")"}return t}exports.createGenerator=function(e){return function(e){if("jsNode"in e)return c(e.jsNode);console.warn("当前代码未经转换器转换")}(e)},exports.createOptimizeParser=function(e,t=[]){o(e,t)},exports.createParser=function(e){return function(e){const t=function(e){const t=1,n=2,r=3,o=4,i=5,l=6,s=[];let c=[],u=t;function d(e){const t=e.charCodeAt();return t>=65&&t<=90||t>=97&&t<=122||/^[\u4E00-\u9FA5]+$/.test(e)||/\s/.test(e)||/\w/.test(e)||"."===e}for(let p=0;p<e.length;p++){const a=e[p];if("<"!==a){if(d(a)){if(c.push(a),u===n){u=r;continue}if(u===t){u=o;continue}if(u===i){u=l;continue}}else if(">"===a){if(u===r){s.push({type:"startTag",tag:c.join("")}),c.length=0,u=t;continue}if(u===l){s.push({type:"endTag",tag:c.join("")}),c.length=0,u=t;continue}}else if("/"===a){u=i;continue}}else u===o&&(s.push({type:"text",content:c.join("")}),c.length=0),u=n}return s}(e),n={type:"Root",children:null},r=[],o=[];for(let e=0;e<t.length;e++){const n=t[e],i=n.type;if("startTag"===i){const e={type:"Element",tag:n.tag,children:[]},t=o[o.length-1];t?t.children.push(e):r.push(e),o.push(e)}else if("endTag"===i)o.pop();else if("text"===i){const e={type:"Text",content:n.content},t=o[o.length-1];t?t.children.push(e):r.push(eleNode)}}return n.children=r,n}(e)},exports.dump=function e(t,n=0){const r=t.type,o="Root"===r?"":"Element"===r?t.tag:t.content;if(console.log(`${"-".repeat(n)}${r}:${o}`),t.children)for(let r=0;r<t.children.length;r++)e(t.children[r],n+2)},exports.getCurrentContext=function(){return r};
