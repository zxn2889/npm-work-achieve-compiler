!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).achieve={})}(this,(function(e){"use strict";var n,t;!function(e){e[e.Root=0]="Root",e[e.Element=1]="Element",e[e.Text=2]="Text",e[e.FunctionDecl=3]="FunctionDecl",e[e.Identifier=4]="Identifier",e[e.ReturnStatement=5]="ReturnStatement",e[e.CallExpression=6]="CallExpression",e[e.TagNode=7]="TagNode",e[e.ArrayParamsNode=8]="ArrayParamsNode"}(n||(n={})),function(e){e[e.origin=1]="origin",e[e.startTag=2]="startTag",e[e.tagName=3]="tagName",e[e.text=4]="text",e[e.endTag=5]="endTag",e[e.endTagName=6]="endTagName"}(t||(t={}));var r,a,o={origin:t.origin,startTag:t.startTag,tagName:t.tagName,text:t.text,endTag:t.endTag,endTagName:t.endTagName};function i(e){for(var t=function(e){var n=[],t=[],a=o.origin;function i(e){var n=e.charCodeAt(0);return n>=65&&n<=90||n>=97&&n<=122||/^[\u4E00-\u9FA5]+$/.test(e)||/\s/.test(e)||/\w/.test(e)||"."===e}for(var c=0;c<e.length;c++){var d=e[c];if("<"!==d){if(i(d)){if(t.push(d),a===o.startTag){a=o.tagName;continue}if(a===o.origin){a=o.text;continue}if(a===o.endTag){a=o.endTagName;continue}}else if(">"===d){if(a===o.tagName){n.push({type:r.StartTag,tag:t.join("")}),t.length=0,a=o.origin;continue}if(a===o.endTagName){n.push({type:r.EndTag,tag:t.join("")}),t.length=0,a=o.origin;continue}}else if("/"===d){a=o.endTag;continue}}else a===o.text&&(n.push({type:r.Text,content:t.join("")}),t.length=0),a=o.startTag}return n}(e),a={type:n.Root,children:[]},i=[],c=[],d=0;d<t.length;d++){var u=t[d],l=u.type;if(l===r.StartTag&&"tag"in u){var s={type:n.Element,tag:u.tag,children:[]};(f=c[c.length-1])&&"children"in f?f.children.push(s):i.push(s),c.push(s)}else if(l===r.EndTag)c.pop();else if(l===r.Text&&"content"in u){var f,p={type:n.Text,content:u.content};(f=c[c.length-1])&&"children"in f?f.children.push(p):i.push(p)}}return a.children=i,a}function c(e,n,t){if(t||2===arguments.length)for(var r,a=0,o=n.length;a<o;a++)!r&&a in n||(r||(r=Array.prototype.slice.call(n,0,a)),r[a]=n[a]);return e.concat(r||Array.prototype.slice.call(n))}function d(e){return function(){var t;e.type===n.Text&&(e.jsNode=(t=e.content,{type:n.Text,context:t}))}}function u(e){return function(){if(e.type===n.Element){var t,r,o=function(e){return{type:n.TagNode,name:e}}(e.tag),i=(t=[o],{type:n.CallExpression,id:(r=a.H,{type:n.Identifier,name:r}),nodes:t});1===e.children.length?i.nodes.push(e.children[0].jsNode):i.nodes.push(function(e){return{type:n.ArrayParamsNode,params:e}}(e.children.map((function(e){return e.jsNode})))),e.jsNode=i}}}function l(e){return function(){if(e.type===n.Root){var t=e.children[0].jsNode;e.jsNode={type:n.FunctionDecl,id:{type:n.Identifier,name:a.Render},params:[],body:[{type:n.ReturnStatement,return:t}]}}}}!function(e){e[e.StartTag=0]="StartTag",e[e.EndTag=1]="EndTag",e[e.Text=2]="Text"}(r||(r={})),"function"==typeof SuppressedError&&SuppressedError,function(e){e.Render="render",e.H="h"}(a||(a={}));var s=null;function f(e,n){void 0===n&&(n=[]);var t={currentNode:null,childIndex:null,parentNode:null,funcs:c([d,u,l],n,!0),removeASTNode:function(){return h.call(t)},replaceASTNode:function(e){return g.call(t,e)}};y(t),p(e,t),y(null)}function p(e,t){t.currentNode=e;var r=e,a=t.funcs,o=[];if(a.length)for(var i=0;i<a.length;i++){var c=a[i](r,t);if(c&&o.push(c),!r)return}if(r.type!==n.Text){var d=r.children;if(d)for(i=0;i<d.length;i++)t.childIndex=i,t.parentNode=r,p(d[i],t)}if(o.length)for(i=o.length-1;i>=0;i--)o[i]()}function g(e){this.parentNode&&(this.currentNode=e,this.parentNode.children[this.childIndex]=e)}function h(){this.parentNode&&(this.parentNode.children.splice(this.childIndex,1),this.currentNode=null)}function y(e){s=e}function m(e){if(e.type===n.FunctionDecl){var t="";return e.type===n.FunctionDecl&&(t+="function"),e.id.type===n.Identifier&&(t+=" ".concat(e.id.name)),e.params.length?t+="(".concat(e.params.join(),")"):t+="()",e.body.length?1===e.body.length&&e.body[0].type===n.ReturnStatement&&(t+="{ return ".concat(T(e.body[0].return)," }")):t+="{ return null }",t}}function T(e){if(e.type===n.CallExpression){var t="";if(e.id.type===n.Identifier&&(t+=e.id.name),e.nodes.length)if(1===e.nodes.length)t+="(".concat(e.nodes[0].name,")");else{for(var r=0;r<e.nodes.length;r++){var a=e.nodes[r];if(a.type===n.TagNode)t+="('".concat(a.name,"'");else if(a.type===n.ArrayParamsNode){if(t+=", [",a.params.length)for(var o=0;o<a.params.length;o++){var i=a.params[o];i.type===n.CallExpression&&(t+="".concat(T(i)).concat(o!==a.params.length-1?", ":""))}t+="]"}else a.type===n.Text&&(t+=", ".concat(a.context))}t+=")"}return t}}e.createGenerator=function(e){return function(e){if("jsNode"in e)return m(e.jsNode);console.warn("当前代码未经转换器转换")}(e)},e.createOptimizeParser=function(e,n){void 0===n&&(n=[]),f(e,n)},e.createParser=function(e){return i(e)},e.dump=function e(t,r){void 0===r&&(r=0);var a=t.type,o=a===n.Root?"":a===n.Element?t.tag:t.content;if(console.log("".concat("-".repeat(r)).concat(a,":").concat(o)),t.children)for(var i=0;i<t.children.length;i++)e(t.children[i],r+2)},e.getCurrentContext=function(){return s}}));
