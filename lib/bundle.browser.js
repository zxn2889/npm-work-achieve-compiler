!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).achieve={})}(this,(function(e){"use strict";function n(e,n,t){if(t||2===arguments.length)for(var r,o=0,i=n.length;o<i;o++)!r&&o in n||(r||(r=Array.prototype.slice.call(n,0,o)),r[o]=n[o]);return e.concat(r||Array.prototype.slice.call(n))}var t,r;function o(e){return function(){var n;e.type===t.Text&&(e.jsNode=(n=e.content,{type:t.Text,context:n}))}}function i(e){return function(){if(e.type===t.Element){var n,o,i=function(e){return{type:t.TagNode,name:e}}(e.tag),c=(n=[i],{type:t.CallExpression,id:(o=r.H,{type:t.Identifier,name:o}),nodes:n});1===e.children.length?c.nodes.push(e.children[0].jsNode):c.nodes.push(function(e){return{type:t.ArrayParamsNode,params:e}}(e.children.map((function(e){return e.jsNode})))),e.jsNode=c}}}function c(e){return function(){if(e.type===t.Root){var n=e.children[0].jsNode;e.jsNode={type:t.FunctionDecl,id:{type:t.Identifier,name:r.Render},params:[],body:[{type:t.ReturnStatement,return:n}]}}}}"function"==typeof SuppressedError&&SuppressedError,function(e){e[e.Root=0]="Root",e[e.Element=1]="Element",e[e.Text=2]="Text",e[e.FunctionDecl=3]="FunctionDecl",e[e.Identifier=4]="Identifier",e[e.ReturnStatement=5]="ReturnStatement",e[e.CallExpression=6]="CallExpression",e[e.TagNode=7]="TagNode",e[e.ArrayParamsNode=8]="ArrayParamsNode"}(t||(t={})),function(e){e.Render="render",e.H="h"}(r||(r={}));var a=null;function l(e,t){void 0===t&&(t=[]);var r={currentNode:null,childIndex:null,parentNode:null,funcs:n([o,i,c],t,!0),removeASTNode:function(){return d.call(r)},replaceASTNode:function(e){return s.call(r,e)}};f(r),u(e,r),f(null)}function u(e,n){n.currentNode=e;var r=e,o=n.funcs,i=[];if(o.length)for(var c=0;c<o.length;c++){var a=o[c](r,n);if(a&&i.push(a),!r)return}if(r.type!==t.Text){var l=r.children;if(l)for(c=0;c<l.length;c++)n.childIndex=c,n.parentNode=r,u(l[c],n)}if(i.length)for(c=i.length-1;c>=0;c--)i[c]()}function s(e){this.parentNode&&(this.currentNode=e,this.parentNode.children[this.childIndex]=e)}function d(){this.parentNode&&(this.parentNode.children.splice(this.childIndex,1),this.currentNode=null)}function f(e){a=e}function p(e){if(e.type===t.FunctionDecl){var n="";return e.type===t.FunctionDecl&&(n+="function"),e.id.type===t.Identifier&&(n+=" ".concat(e.id.name)),e.params.length?n+="(".concat(e.params.join(),")"):n+="()",e.body.length?1===e.body.length&&e.body[0].type===t.ReturnStatement&&(n+="{ return ".concat(h(e.body[0].return)," }")):n+="{ return null }",n}}function h(e){if(e.type===t.CallExpression){var n="";if(e.id.type===t.Identifier&&(n+=e.id.name),e.nodes.length)if(1===e.nodes.length)n+="(".concat(e.nodes[0].name,")");else{for(var r=0;r<e.nodes.length;r++){var o=e.nodes[r];if(o.type===t.TagNode)n+="('".concat(o.name,"'");else if(o.type===t.ArrayParamsNode){if(n+=", [",o.params.length)for(var i=0;i<o.params.length;i++){var c=o.params[i];c.type===t.CallExpression&&(n+="".concat(h(c)).concat(i!==o.params.length-1?", ":""))}n+="]"}else o.type===t.Text&&(n+=", ".concat(o.context))}n+=")"}return n}}e.createGenerator=function(e){return function(e){if("jsNode"in e)return p(e.jsNode);console.warn("当前代码未经转换器转换")}(e)},e.createOptimizeParser=function(e,n){void 0===n&&(n=[]),l(e,n)},e.createParser=function(e){return function(e){const n=function(e){const n=1,t=2,r=3,o=4,i=5,c=6,a=[];let l=[],u=n;function s(e){const n=e.charCodeAt();return n>=65&&n<=90||n>=97&&n<=122||/^[\u4E00-\u9FA5]+$/.test(e)||/\s/.test(e)||/\w/.test(e)||"."===e}for(let d=0;d<e.length;d++){const f=e[d];if("<"!==f){if(s(f)){if(l.push(f),u===t){u=r;continue}if(u===n){u=o;continue}if(u===i){u=c;continue}}else if(">"===f){if(u===r){a.push({type:"startTag",tag:l.join("")}),l.length=0,u=n;continue}if(u===c){a.push({type:"endTag",tag:l.join("")}),l.length=0,u=n;continue}}else if("/"===f){u=i;continue}}else u===o&&(a.push({type:"text",content:l.join("")}),l.length=0),u=t}return a}(e),t={type:"Root",children:null},r=[],o=[];for(let e=0;e<n.length;e++){const t=n[e],i=t.type;if("startTag"===i){const e={type:"Element",tag:t.tag,children:[]},n=o[o.length-1];n?n.children.push(e):r.push(e),o.push(e)}else if("endTag"===i)o.pop();else if("text"===i){const e={type:"Text",content:t.content},n=o[o.length-1];n?n.children.push(e):r.push(eleNode)}}return t.children=r,t}(e)},e.dump=function e(n,r){void 0===r&&(r=0);var o=n.type,i=o===t.Root?"":o===t.Element?n.tag:n.content;if(console.log("".concat("-".repeat(r)).concat(o,":").concat(i)),n.children)for(var c=0;c<n.children.length;c++)e(n.children[c],r+2)},e.getCurrentContext=function(){return a}}));
